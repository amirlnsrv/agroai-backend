from __future__ import annotations

from typing import List, Optional

BASE_REC = {
    "Healthy": [
        "Продолжайте текущий режим ухода (полив/свет).",
        "Проводите осмотр листьев раз в 3–5 дней, чтобы быстро заметить изменения.",
        "Снимайте фото при хорошем освещении — так диагностика точнее.",
    ],
    "Leaf spot": [
        "Удалите сильно поражённые листья и утилизируйте их (не компостируйте).",
        "Избегайте полива по листьям, лучше — под корень. Уменьшите влажность.",
        "Если пятна распространяются, рассмотрите обработку фунгицидом строго по инструкции.",
    ],
    "Yellowing": [
        "Проверьте режим полива и дренаж: перелив часто даёт пожелтение.",
        "Проверьте дефицит питания (азот/железо/магний). Подкормку делайте по нормам.",
        "Сравните с молодыми листьями: если желтеют старые — чаще нехватка азота.",
    ],
    "Pest damage": [
        "Осмотрите нижнюю сторону листьев: тля, белокрылка, клещ часто прячутся там.",
        "Промойте листья и изолируйте растение, если возможно.",
        "При необходимости используйте безопасный инсектицид/биопрепарат по инструкции.",
    ],
    "Mold": [
        "Улучшите проветривание и уменьшите влажность.",
        "Сократите полив, особенно вечером. Проверьте, не стоит ли вода в поддоне/почве.",
        "Если плесень усиливается — обработка противогрибковым средством по инструкции.",
    ],
}

CULTURE_HINTS = {
    "tomato": {
        "Leaf spot": ["Для томатов проверьте фитофтору/альтернариоз; соблюдайте расстояние между кустами."],
        "Yellowing": ["У томатов пожелтение часто из-за перелива или нехватки азота на стадии роста."],
    },
    "cucumber": {
        "Mold": ["У огурцов плесень/мучнистая роса часты при высокой влажности — проветривайте теплицу."],
    },
    "potato": {
        "Leaf spot": ["У картофеля обратите внимание на фитофтороз; важна профилактика и удаление поражённых листьев."],
    },
}


def get_recommendations(label: str, culture: Optional[str] = None) -> List[str]:
    rec = list(BASE_REC.get(label, ["Сделайте повторное фото при хорошем освещении и попробуйте ещё раз."]))

    if culture:
        key = culture.strip().lower()
        hints = CULTURE_HINTS.get(key, {}).get(label, [])
        # add culture-specific hints to the top
        rec = hints + rec

    return rec
